<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>js13k Audio elements</title>
        <script type="text/javascript" src="gamesounds.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    </head>
    <body>


        <button class="selectSound" id="template" style="display: none;"></button>

        <p>Click on the canvas to trigger a sound, move the mouse to change the position of the sound emitter</p>
        <canvas id="canvas" width="500" height="500"></canvas><br />

        <script type="text/javascript">


            function updateCanvas(ctx, sx, sy, lx, ly){
                ctx.fillStyle="#333333";
                ctx.fillRect(0,0,500,500);
                ctx.fillStyle="#ff0000";
                ctx.fillRect(sx-3, sy-3, 6, 6);

                ctx.fillStyle="#3f3fff";
                ctx.fillRect(lx-3, ly-3, 6, 6);
            }

            $(function(){

                for (var sound in gameSounds.sounds){

                    $('button#template').clone().removeAttr('id').attr('data-sound', sound).text(sound).show().appendTo('body');

                }

                $('button.selectSound').click(function(){

                    soundSelected = $(this).attr('data-sound');
                });


                for (var soundSelected in gameSounds.sounds) break; //default to the first element of the object


                var c = document.getElementById("canvas");
                var ctx = c.getContext("2d");

                var mouseX, mouseY;

                var offset = $('#canvas').offset();

                var listenerX = 250, listenerY = 250;

                gameSounds.ac.listener.setPosition(listenerX, listenerY, 0);

                updateCanvas(ctx, 0, 0, listenerX, listenerY);

                console.log('offset', offset);

                var currentSound = false;

                $('#canvas').mouseenter(function(){
                    mouseInCanvas = true;
//                    console.log('mouse in');
                }).mouseleave(function(){
                    mouseInCanvas = false;
//                    console.log('mouse out');
                }).mousemove(function(e){
//                    console.log('moving');
                    updateCanvas(ctx, e.clientX - offset.left, e.clientY - offset.top, listenerX, listenerY);


                    if (currentSound && currentSound.isPlaying()){
                        currentSound.updateLocation(e.clientX - offset.left, e.clientY - offset.top);
                    }
                }).mousedown(function(e){

                    console.log(soundSelected);

                    currentSound = gameSounds.getSound(soundSelected);

                            console.log(sound);

                    currentSound.playSingle(e.clientX - offset.left, e.clientY - offset.top);

                    delete currentSound;

                }).mouseup(function(){

                });

            });

        </script>
    </body>
</html>