<!DOCTYPE html>

<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>js13k Audio elements</title>
        <script type="text/javascript" src="gamesounds.js"></script>
        <script type="text/javascript" src="soundbuilder.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    </head>
    <body>


        <button class="selectSound" id="template" style="display: none;"></button>

        <p>Click on the canvas to trigger a sound, move the mouse to change the position of the sound emitter</p>
        <!--<canvas id="canvas" width="500" height="500"></canvas>-->
        <div id="sound_builder"></div>
        <br />
        Volume: <input type="range" id="volume" min="0" max="100" />



        <script type="text/javascript">


            var sounds = {

                rand3: {
                    duration: 1.5,
                    wave: 0,
                    freq: {
                        points: [
                            [0.0, 900, 0], //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                            [0.5, 400, 2],
                            [0.5, 900, 0],
                            [1.0, 400, 2],
                            [1.0, 900, 0],
                            [1.5, 400, 2]
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0],
                            [0.5, 0.0, 1],
                            [0.5, 2.0, 0],
                            [1.0, 0.0, 1],
                            [1.0, 0.5, 0],
                            [1.5, 0.0, 1]
                        ]
                    },
                    mod: {
                        wave: 3,
                        freq: 90,
                        gain: 100
                    }
                },

                pulse: {
                    duration: 1.8,
                    wave: 0,
                    freq: {
                        points: [
                            [0.0, 900, 0], //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                            [1.8, 400, 2]
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0],
                            [1.7, 5.0, 0],
                            [1.8, 1.0, 1]
                        ]
                    },
                    mod: {
                        wave: 3,
                        freq: 90,
                        gain: 100
                    }
                },

                buzz: {
                    wave: 2,
                    freq: {
                        points: [
                            [0.0, 300, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0]
                        ]
                    },
                    mod: {
                        wave: 3,
                        freq: 90,
                        gain: 100
                    }
                },

                playerSound: {
                    wave: 2,
                    freq: {
                        points: [
                            [0.0, 300, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 1.0, 0]
                        ]
                    },
                    mod: {
                        wave: 3,
                        freq: 90,
                        gain: 100
                    }
                },

                otherPlayerSound: {
                    wave: 2,
                    freq: {
                        points: [
                            [0.0, 300, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0]
                        ]
                    },
                    mod: {
                        wave: 3,
                        freq: 90,
                        gain: 100
                    }
                },

                rand1: {
                    duration: 6.0,
                    wave: 0,
                    freq: {
                        points: [
                            [0.0, 600, 0], //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                            [1.5, 800, 1],
                            [1.6, 700, 0],
                            [3.0, 950, 1],
                            [3.1, 850, 0],
                            [4.5, 1100, 1],
                            [6.0, 100, 2]
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0],
                            [4.0, 4.0, 1],
                            [5.9, 0.0, 1]
                        ]
                    },
                    mod: {
                        wave: 1,
                        freq: 9,
                        gain: 100
                    }
                },

                rand2: {
                    duration: 2.0,
                    wave: 0,
                    freq: {
                        points: [
                            [0.0, 80, 0], //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
//                                    [0.9, 50, 2],
                            [1.0, 70, 0]
//                                    [2.0, 40, 2]
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0],
                            [1.0, 5.0, 0],
                            [2.0, 0.0, 1]
                        ]
                    },
                    mod: {
                        wave: 1,
                        freq: 100,
                        gain: 50
                    }
                },

                yesThisIsPhone: {
                    duration: 2.0,
                    wave: 3,
                    freq: {
                        points: [
                            [0.0, 700, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0],
                            [1.0, 5.0, 0],
                            [1.1, 0.0, 1],
                            [1.2, 5.0, 1]
                        ]
                    },
                    mod: {
                        wave: 1,
                        freq: 10,
                        gain: 100
                    }
                },

                siren: {
                    duration: 2.0,
                    wave: 3,
                    freq: {
                        points: [
                            [0.0, 700, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0]
                        ]
                    },
                    mod: {
                        wave: 3,
                        freq: 2,
                        gain: 100
                    }
                },

                alert: {
                    duration: 2.0,
                    wave: 3,
                    freq: {
                        points: [
                            [0.0, 700, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0]
                        ]
                    },
                    mod: {
                        wave: 1,
                        freq: 2,
                        gain: 100
                    }
                },

                alert_continuous: {
                    wave: 3,
                    freq: {
                        points: [
                            [0.0, 700, 0] //time, frequency, 0=set, 1=linear ramp, 2= exp ramp
                        ]
                    },
                    vol: {
                        points: [
                            [0.0, 5.0, 0]
                        ]
                    },
                    mod: {
                        wave: 1,
                        freq: 2,
                        gain: 100
                    }
                }


            };

            var soundBuilder = new SoundBuilder(document.getElementById('sound_builder'));
            soundBuilder.createBuildInterface(1000, 500);
            soundBuilder.createTestInterface(500, 500);
/*
            var gs = new GameSounds(sounds);

            function updateCanvas(ctx, sx, sy, lx, ly){
                ctx.fillStyle="#333333";
                ctx.fillRect(0,0,500,500);
                ctx.fillStyle="#ff0000";
                ctx.fillRect(sx-3, sy-3, 6, 6);

                ctx.fillStyle="#3f3fff";
                ctx.fillRect(lx-3, ly-3, 6, 6);
            }



            $(function(){

                for (var sound in sounds){

                    $('button#template').clone().removeAttr('id').attr('data-sound', sound).text(sound).show().appendTo('body');

                }

                $('button.selectSound').click(function(){

                    soundSelected = $(this).attr('data-sound');
                });


                for (var soundSelected in sounds) break; //default to the first element of the object


                var c = document.getElementById("canvas");
                var ctx = c.getContext("2d");

                var mouseX, mouseY;

                var offset = $('#canvas').offset();

                var listenerX = 250, listenerY = 250;

                gs.playerPosition(listenerX, listenerY);

                updateCanvas(ctx, 0, 0, listenerX, listenerY);

                var currentSound = false;

                $('#canvas').mouseenter(function(){
                    mouseInCanvas = true;
                }).mouseleave(function(){
                    mouseInCanvas = false;
                }).mousemove(function(e){
                    updateCanvas(ctx, e.clientX - offset.left, e.clientY - offset.top, listenerX, listenerY);

                    if (currentSound && currentSound.isPlaying()){
                        currentSound.at(e.clientX - offset.left, e.clientY - offset.top);
                    }
                }).mousedown(function(e){

                    currentSound = gs.get(soundSelected).at(e.clientX - offset.left, e.clientY - offset.top).start();

                }).mouseup(function(){
                    currentSound.stop();
                });

                $('#volume').change(function(){
                    gs.setVolume(Number($(this).val()));
                });

            });

        */

        </script>
    </body>
</html>